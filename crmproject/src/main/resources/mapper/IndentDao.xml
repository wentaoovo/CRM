<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.trkj.crmproject.dao.wentao.IndentDao">
  <resultMap id="BaseResultMap" type="com.trkj.crmproject.entity.wentao.Indent">
    <id column="id" jdbcType="VARCHAR" property="id" />
    <result column="theme" jdbcType="VARCHAR" property="theme" />
    <result column="classify" jdbcType="VARCHAR" property="classify" />
    <result column="customer_id" jdbcType="VARCHAR" property="customerId" />
    <result column="customer_name" jdbcType="VARCHAR" property="customerName" />
    <result column="chance_id" jdbcType="VARCHAR" property="chanceId" />
    <result column="chance_name" jdbcType="VARCHAR" property="chanceName" />
    <result column="total_money" jdbcType="DECIMAL" property="totalMoney" />
    <result column="indent_date" jdbcType="DATE" property="indentDate" />
    <result column="latest_delivery_date" jdbcType="DATE" property="latestDeliveryDate" />
    <result column="contacts_id" jdbcType="VARCHAR" property="contactsId" />
    <result column="contacts_name" jdbcType="VARCHAR" property="contactsName" />
    <result column="remark" jdbcType="VARCHAR" property="remark" />
    <result column="out_money" jdbcType="DECIMAL" property="outMoney" />
    <result column="returned_money" jdbcType="DECIMAL" property="returnedMoney" />
    <result column="cost" jdbcType="DECIMAL" property="cost" />
    <result column="discount" jdbcType="DECIMAL" property="discount" />
    <result column="gross_margin" jdbcType="DECIMAL" property="grossMargin" />
    <result column="forgross_margin" jdbcType="DECIMAL" property="forgrossMargin" />
    <result column="invoice_value" jdbcType="DECIMAL" property="invoiceValue" />
    <result column="freight" jdbcType="DECIMAL" property="freight" />
    <result column="possessor_id" jdbcType="VARCHAR" property="possessorId" />
    <result column="possessor" jdbcType="VARCHAR" property="possessor" />
    <result column="state" jdbcType="INTEGER" property="state" />
    <result column="addressee" jdbcType="VARCHAR" property="addressee" />
    <result column="addressee_telephone" jdbcType="VARCHAR" property="addresseeTelephone" />
    <result column="addressee_phone" jdbcType="VARCHAR" property="addresseePhone" />
    <result column="province" jdbcType="VARCHAR" property="province" />
    <result column="city" jdbcType="VARCHAR" property="city" />
    <result column="address_type" jdbcType="VARCHAR" property="addressType" />
    <result column="addressee_site" jdbcType="VARCHAR" property="addresseeSite" />
    <result column="postcode" jdbcType="VARCHAR" property="postcode" />
    <result column="AddName" jdbcType="VARCHAR" property="addname" />
    <result column="AddTime" jdbcType="TIMESTAMP" property="addtime" />
    <result column="UpdateName" jdbcType="VARCHAR" property="updatename" />
    <result column="UpdateTime" jdbcType="TIMESTAMP" property="updatetime" />
    <result column="DeleteName" jdbcType="VARCHAR" property="deletename" />
    <result column="DeleteTime" jdbcType="TIMESTAMP" property="deletetime" />
    <result column="TimeLiness" jdbcType="INTEGER" property="timeliness" />
    <collection property="indentDetail" ofType="com.trkj.crmproject.entity.wentao.IndentDetail">
      <id column="l_id" jdbcType="VARCHAR" property="id" />
      <result column="indent_id" jdbcType="VARCHAR" property="indentId" />
      <result column="product_id" jdbcType="VARCHAR" property="productId" />
      <result column="product_name" jdbcType="VARCHAR" property="productName" />
      <result column="unit_price" jdbcType="DECIMAL" property="unitPrice" />
      <result column="money" jdbcType="DECIMAL" property="money" />
      <result column="quantity" jdbcType="INTEGER" property="quantity" />
      <result column="model" jdbcType="VARCHAR" property="model" />
      <result column="l_discount" jdbcType="DECIMAL" property="discount" />
      <result column="l_remark" jdbcType="VARCHAR" property="remark" />
      <result column="AddName" jdbcType="VARCHAR" property="addname" />
      <result column="AddTime" jdbcType="TIMESTAMP" property="addtime" />
      <result column="UpdateName" jdbcType="VARCHAR" property="updatename" />
      <result column="UpdateTime" jdbcType="TIMESTAMP" property="updatetime" />
      <result column="DeleteName" jdbcType="VARCHAR" property="deletename" />
      <result column="DeleteTime" jdbcType="TIMESTAMP" property="deletetime" />
      <result column="TimeLiness" jdbcType="INTEGER" property="timeliness" />
    </collection>
  </resultMap>
  <sql id="Base_Column_List">
    id, theme, classify, customer_id, customer_name, chance_id, chance_name, total_money, 
    indent_date, latest_delivery_date, contacts_id, contacts_name, remark, out_money, 
    returned_money, cost, discount, gross_margin, forgross_margin, invoice_value, freight, 
    possessor_id, possessor, `state`, addressee, addressee_telephone, addressee_phone, 
    province, city, address_type, addressee_site, postcode, AddName, AddTime, UpdateName, 
    UpdateTime, DeleteName, DeleteTime, TimeLiness
  </sql>
  <sql id="Base_Column_List2">
    e.id, e.theme, e.classify, e.customer_id, e.customer_name, e.chance_id, e.chance_name, e.total_money,
    e.indent_date, e.latest_delivery_date, e.contacts_id, e.contacts_name, e.remark, e.out_money,
    e.returned_money, e.cost, e.discount, e.gross_margin, e.forgross_margin, e.invoice_value, e.freight,
    e.possessor_id, e.possessor, e.`state`, e.addressee, e.addressee_telephone, e.addressee_phone,
    e.province, e.city, e.address_type, e.addressee_site, e.postcode,
    l.id l_id, l.indent_id, l.product_id, l.product_name, l.unit_price, l.money, l.quantity, l.model, l.discount l_discount,
    l.remark l_remark
  </sql>
  <select id="selectById" parameterType="java.lang.String" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from indent
    where id = #{id,jdbcType=VARCHAR}
  </select>
  <select id="selectAll" parameterType="com.trkj.crmproject.vo.Indent.SearchListVo" resultMap="BaseResultMap">
    select <include refid="Base_Column_List"></include>
    from indent
    <where>
      <if test="classify !=null">
        and classify =#{classify}
      </if>
      <if test="state !=null">
        and `state` =#{state}
      </if>
      <if test="keyword !=null">
        and CONCAT(IFNULL(id,''),IFNULL(theme,''),IFNULL(customer_name,''),IFNULL(possessor,'')) LIKE "%"#{keyword}"%"
      </if>
      and timeliness = 0
    </where>
  </select>
<!-- 订单,明细连接查询 -->
  <select id="selectJoin" parameterType="java.lang.String" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List2" />
    from indent e left join indent_detail l on e.id=l.indent_id
    where e.id = #{id,jdbcType=VARCHAR}
  </select>
  <insert id="insert" parameterType="com.trkj.crmproject.entity.wentao.Indent">
    insert into indent (id,theme, classify, customer_id,
      customer_name, chance_id, chance_name, 
      total_money, indent_date, latest_delivery_date, 
      contacts_id, contacts_name, remark, 
      out_money, returned_money, cost, 
      discount, gross_margin, forgross_margin, 
      invoice_value, freight, possessor_id, 
      possessor, `state`, addressee, 
      addressee_telephone, addressee_phone, province, 
      city, address_type, addressee_site, 
      postcode, AddName, AddTime, 
      UpdateName, UpdateTime, DeleteName, 
      DeleteTime, TimeLiness)
    values (#{id},#{theme,jdbcType=VARCHAR}, #{classify,jdbcType=VARCHAR}, #{customerId,jdbcType=VARCHAR},
      #{customerName,jdbcType=VARCHAR}, #{chanceId,jdbcType=VARCHAR}, #{chanceName,jdbcType=VARCHAR}, 
      #{totalMoney,jdbcType=DECIMAL}, #{indentDate,jdbcType=DATE}, #{latestDeliveryDate,jdbcType=DATE}, 
      #{contactsId,jdbcType=VARCHAR}, #{contactsName,jdbcType=VARCHAR}, #{remark,jdbcType=VARCHAR}, 
      #{outMoney,jdbcType=DECIMAL}, #{returnedMoney,jdbcType=DECIMAL}, #{cost,jdbcType=DECIMAL}, 
      #{discount,jdbcType=DECIMAL}, #{grossMargin,jdbcType=DECIMAL}, #{forgrossMargin,jdbcType=DECIMAL}, 
      #{invoiceValue,jdbcType=DECIMAL}, #{freight,jdbcType=DECIMAL}, #{possessorId,jdbcType=VARCHAR}, 
      #{possessor,jdbcType=VARCHAR}, #{state,jdbcType=INTEGER}, #{addressee,jdbcType=VARCHAR}, 
      #{addresseeTelephone,jdbcType=VARCHAR}, #{addresseePhone,jdbcType=VARCHAR}, #{province,jdbcType=VARCHAR}, 
      #{city,jdbcType=VARCHAR}, #{addressType,jdbcType=VARCHAR}, #{addresseeSite,jdbcType=VARCHAR}, 
      #{postcode,jdbcType=VARCHAR}, #{addname,jdbcType=VARCHAR}, #{addtime,jdbcType=TIMESTAMP}, 
      #{updatename,jdbcType=VARCHAR}, #{updatetime,jdbcType=TIMESTAMP}, #{deletename,jdbcType=VARCHAR}, 
      #{deletetime,jdbcType=TIMESTAMP}, #{timeliness,jdbcType=INTEGER})
  </insert>
  <update id="deleteTl">
    update indent
    set TimeLiness = 1,
    DeleteTime = #{deletetime}
    where id = #{id,jdbcType=VARCHAR}
  </update>
  <update id="update" parameterType="com.trkj.crmproject.entity.wentao.Indent">
    update indent
    set theme = #{theme,jdbcType=VARCHAR},
      classify = #{classify,jdbcType=VARCHAR},
      customer_id = #{customerId,jdbcType=VARCHAR},
      customer_name = #{customerName,jdbcType=VARCHAR},
      chance_id = #{chanceId,jdbcType=VARCHAR},
      chance_name = #{chanceName,jdbcType=VARCHAR},
      total_money = #{totalMoney,jdbcType=DECIMAL},
      indent_date = #{indentDate,jdbcType=DATE},
      latest_delivery_date = #{latestDeliveryDate,jdbcType=DATE},
      contacts_id = #{contactsId,jdbcType=VARCHAR},
      contacts_name = #{contactsName,jdbcType=VARCHAR},
      remark = #{remark,jdbcType=VARCHAR},
      out_money = #{outMoney,jdbcType=DECIMAL},
      returned_money = #{returnedMoney,jdbcType=DECIMAL},
      cost = #{cost,jdbcType=DECIMAL},
      discount = #{discount,jdbcType=DECIMAL},
      gross_margin = #{grossMargin,jdbcType=DECIMAL},
      forgross_margin = #{forgrossMargin,jdbcType=DECIMAL},
      invoice_value = #{invoiceValue,jdbcType=DECIMAL},
      freight = #{freight,jdbcType=DECIMAL},
      possessor_id = #{possessorId,jdbcType=VARCHAR},
      possessor = #{possessor,jdbcType=VARCHAR},
      `state` = #{state,jdbcType=INTEGER},
      addressee = #{addressee,jdbcType=VARCHAR},
      addressee_telephone = #{addresseeTelephone,jdbcType=VARCHAR},
      addressee_phone = #{addresseePhone,jdbcType=VARCHAR},
      province = #{province,jdbcType=VARCHAR},
      city = #{city,jdbcType=VARCHAR},
      address_type = #{addressType,jdbcType=VARCHAR},
      addressee_site = #{addresseeSite,jdbcType=VARCHAR},
      postcode = #{postcode,jdbcType=VARCHAR},
      UpdateTime = #{updatetime,jdbcType=TIMESTAMP}
    where id = #{id,jdbcType=VARCHAR}
  </update>
</mapper>